--[[
    NeonUI Library - Enhanced Version
    Desarrollado por: MRX
    Actualizaciones: Claude
    
    Mejoras implementadas:
    - Efectos visuales mejorados y animaciones más fluidas
    - Separadores dinámicos que se ajustan al texto
    - Sistema responsive automático para PC/móvil
    - Posicionamiento optimizado de elementos
    - Nuevas transiciones y efectos para tema Lava
    - Optimización de rendimiento
]]

-- Servicios
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

-- Variables locales
local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()
local isMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

-- Constantes UI - Tema Lava (Mejorado)
local FONT = Enum.Font.GothamSemibold
local FONT_SIZE = isMobile and 16 or 14
local PRIMARY_COLOR = Color3.fromRGB(22, 7, 7)      -- Rojo oscuro más profundo
local SECONDARY_COLOR = Color3.fromRGB(35, 12, 12)  -- Rojo más claro
local ACCENT_COLOR = Color3.fromRGB(255, 70, 15)    -- Naranja lava más vibrante
local TEXT_COLOR = Color3.fromRGB(255, 255, 255)    -- Blanco
local TRANSPARENCY = 0.03                           -- Transparencia reducida
local CORNER_RADIUS = UDim.new(0, 8)
local STROKE_THICKNESS = 1.5
local STROKE_COLOR = Color3.fromRGB(240, 35, 35)    -- Borde rojo intenso
local GLOW_COLOR = Color3.fromRGB(255, 110, 25)     -- Brillo lava

-- Factor de escala según dispositivo (ajusta todo el UI)
local SCALE_FACTOR = isMobile and 1.2 or 1.0

-- Utilidades
local Utility = {}

-- Crear objetos de instancia con propiedades
function Utility:Create(instance, properties, children)
    local object = Instance.new(instance)
    
    for property, value in pairs(properties or {}) do
        object[property] = value
    end
    
    for _, child in ipairs(children or {}) do
        child.Parent = object
    end
    
    return object
end

-- Crear Tween con opciones mejoradas
function Utility:Tween(instance, properties, duration, style, direction, repeatCount, reverses, delayTime)
    style = style or Enum.EasingStyle.Quint
    direction = direction or Enum.EasingDirection.Out
    
    local tweenInfo = TweenInfo.new(
        duration,
        style,
        direction,
        repeatCount or 0,
        reverses or false,
        delayTime or 0
    )
    
    local tween = TweenService:Create(instance, tweenInfo, properties)
    tween:Play()
    return tween
end

-- Ripple Effect mejorado (efecto de onda al hacer clic)
function Utility:Ripple(instance, rippleColor)
    rippleColor = rippleColor or GLOW_COLOR
    
    -- Usar posición relativa para mejor precisión
    local x, y
    
    if isMobile and UserInputService:GetLastInputType() == Enum.UserInputType.Touch then
        -- Para dispositivos móviles, usar la posición del último toque
        local touchPositions = UserInputService:GetTouchPosition()
        if touchPositions then
            x = touchPositions.X - instance.AbsolutePosition.X
            y = touchPositions.Y - instance.AbsolutePosition.Y
        else
            x = instance.AbsoluteSize.X/2
            y = instance.AbsoluteSize.Y/2
        end
    else
        -- Para PC, usar la posición del ratón
        x = Mouse.X - instance.AbsolutePosition.X
        y = Mouse.Y - instance.AbsolutePosition.Y
    end
    
    -- Si está fuera de los límites, usar el centro
    if x < 0 or x > instance.AbsoluteSize.X or y < 0 or y > instance.AbsoluteSize.Y then
        x = instance.AbsoluteSize.X/2
        y = instance.AbsoluteSize.Y/2
    end
    
    local ripple = self:Create("Frame", {
        Name = "Ripple",
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = rippleColor,
        BackgroundTransparency = 0.7,
        Position = UDim2.fromOffset(x, y),
        Size = UDim2.fromScale(0, 0),
        ZIndex = 2,
        Parent = instance
    })
    
    local corner = self:Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = ripple
    })
    
    -- Animación más suave con Quint easing
    local targetSize = UDim2.fromScale(2.5, 2.5)
    self:Tween(ripple, {Size = targetSize, BackgroundTransparency = 1}, 0.6, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
    
    task.delay(0.6, function()
        ripple:Destroy()
    end)
end

-- Arrastrar elementos - Mejorado para móvil con física
function Utility:Draggable(frame, dragui)
    local dragging, dragInput, dragStart, startPos
    local dragDelay = 0.05
    local clickTime = 0
    local dragDistance = 5
    local dragInertia = Vector2.new(0, 0)
    local inertiaFading = false
    
    local function updateDrag(input)
        local delta = input.Position - dragStart
        if (delta.Magnitude > dragDistance) then
            local newPosition = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            
            -- Calcular la inercia basada en el movimiento
            dragInertia = Vector2.new(delta.X * 0.05, delta.Y * 0.05)
            
            -- Aplicar efecto de "físicas" al arrastrar
            self:Tween(frame, {Position = newPosition}, 0.1, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
        end
    end
    
    -- Inicio del arrastre
    dragui.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            clickTime = tick()
            dragStart = input.Position
            startPos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                    
                    -- Aplicar inercia al soltar
                    if dragInertia.Magnitude > 0.1 and not inertiaFading then
                        inertiaFading = true
                        
                        local inertiaPos = UDim2.new(
                            frame.Position.X.Scale, 
                            frame.Position.X.Offset + dragInertia.X * 20, 
                            frame.Position.Y.Scale, 
                            frame.Position.Y.Offset + dragInertia.Y * 20
                        )
                        
                        self:Tween(frame, {Position = inertiaPos}, 0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
                        
                        task.delay(0.3, function()
                            dragInertia = Vector2.new(0, 0)
                            inertiaFading = false
                        end)
                    end
                end
            end)
            
            -- Activar arrastre después de un pequeño retraso (para móvil)
            task.delay(dragDelay, function()
                if (tick() - clickTime > dragDelay) then
                    dragging = true
                end
            end)
        end
    end)
    
    dragui.InputChanged:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) and dragging then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            updateDrag(input)
        end
    end)
end

-- Crear efecto de resplandor mejorado
function Utility:CreateGlow(parent, color, size, transparency)
    if parent:FindFirstChild("Glow") then
        parent.Glow:Destroy()
    end
    
    local glow = self:Create("ImageLabel", {
        Name = "Glow",
        BackgroundTransparency = 1,
        Image = "rbxassetid://5028857084", -- Imagen de resplandor circular
        ImageColor3 = color or GLOW_COLOR,
        ImageTransparency = transparency or 0.7,
        ZIndex = parent.ZIndex - 1,
        Parent = parent
    })
    
    -- Calcular tamaño del resplandor
    local growSize = size or 1.5
    local parentSize = parent.AbsoluteSize
    glow.Size = UDim2.new(1, parentSize.X * (growSize - 1), 1, parentSize.Y * (growSize - 1))
    glow.Position = UDim2.new(0.5, -parentSize.X * (growSize - 1)/2, 0.5, -parentSize.Y * (growSize - 1)/2)
    glow.AnchorPoint = Vector2.new(0.5, 0.5)
    
    -- Animar el resplandor con transición suave
    spawn(function()
        local pulseSpeed = 0.03
        local minTrans = 0.6
        local maxTrans = 0.85
        
        while glow.Parent do
            for i = minTrans, maxTrans, pulseSpeed do
                if not glow or not glow.Parent then break end
                self:Tween(glow, {ImageTransparency = i}, 0.1)
                wait(0.05)
            end
            for i = maxTrans, minTrans, -pulseSpeed do
                if not glow or not glow.Parent then break end
                self:Tween(glow, {ImageTransparency = i}, 0.1)
                wait(0.05)
            end
        end
    end)
    
    return glow
end

-- Crear partículas de lava mejoradas
function Utility:CreateLavaParticles(parent, count)
    -- Eliminar partículas anteriores si existen
    if parent:FindFirstChild("LavaParticles") then
        parent.LavaParticles:Destroy()
    end
    
    local particleCount = count or (isMobile and 8 or 15)
    local container = self:Create("Frame", {
        Name = "LavaParticles",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        ClipsDescendants = true,
        ZIndex = parent.ZIndex + 1,
        Parent = parent
    })
    
    for i = 1, particleCount do
        local size = math.random(2, 6)
        local initialTransparency = math.random(4, 7)/10
        
        local particle = self:Create("Frame", {
            Name = "Particle_" .. i,
            BackgroundColor3 = GLOW_COLOR,
            BackgroundTransparency = initialTransparency,
            BorderSizePixel = 0,
            Position = UDim2.new(math.random(), 0, math.random(), 0),
            Size = UDim2.new(0, size, 0, size),
            ZIndex = container.ZIndex,
            Parent = container
        })
        
        -- Hacer redondas las partículas
        self:Create("UICorner", {
            CornerRadius = UDim.new(1, 0),
            Parent = particle
        })
        
        -- Añadir brillo sutil a las partículas
        if math.random() > 0.7 then  -- Solo algunas partículas tienen brillo (optimización)
            self:CreateGlow(particle, GLOW_COLOR, 1.3, 0.8)
        end
        
        -- Animar partícula con movimientos más naturales
        spawn(function()
            local speed = math.random(8, 25)/1000
            local startPosX = particle.Position.X.Scale
            local wobbleSpeed = math.random(5, 20)/10
            local wobbleIntensity = math.random(5, 20)/1000
            local scaleVariation = math.random(8, 12)/10
            
            while particle.Parent do
                -- Movimiento ascendente
                local newPosY = (particle.Position.Y.Scale - speed) % 1.2
                if newPosY > 1 then 
                    -- Reiniciar desde abajo con nueva posición X
                    newPosY = -0.2 
                    startPosX = math.random()
                end
                
                -- Movimiento en zigzag más natural
                local wobble = math.sin(time() * wobbleSpeed) * wobbleIntensity
                local newPosX = (startPosX + wobble) % 1
                
                -- Actualizar posición
                particle.Position = UDim2.new(newPosX, 0, newPosY, 0)
                
                -- Cambio de tamaño pulsante
                local sizeFactor = 0.9 + math.sin(time() * 1.5) * 0.1
                particle.Size = UDim2.new(0, size * sizeFactor * scaleVariation, 0, size * sizeFactor * scaleVariation)
                
                -- Cambio de transparencia
                particle.BackgroundTransparency = initialTransparency + math.sin(time() * 2) * 0.15
                
                wait()
            end
        end)
    end
    
    return container
end

-- Nuevo: Crear separador dinámico basado en el texto
function Utility:CreateDynamicSeparator(parent, textLabel, color, yOffset, widthPercentage)
    local separatorName = textLabel.Name .. "Separator"
    if parent:FindFirstChild(separatorName) then
        parent[separatorName]:Destroy()
    end
    
    local textSize = textLabel.TextBounds.X
    local widthFactor = widthPercentage or 1.0
    
    local separator = self:Create("Frame", {
        Name = separatorName,
        BackgroundColor3 = color or ACCENT_COLOR,
        BorderSizePixel = 0,
        Position = UDim2.new(0, textLabel.Position.X.Offset, 0, textLabel.Position.Y.Offset + (yOffset or 25)),
        Size = UDim2.new(0, 0, 0, 2),
        Parent = parent
    })
    
    -- Animación de aparición
    self:Tween(separator, {Size = UDim2.new(0, textSize * widthFactor, 0, 2)}, 0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
    
    -- Añadir gradiente
    local gradient = self:Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, color or ACCENT_COLOR),
            ColorSequenceKeypoint.new(1, (color or ACCENT_COLOR):Lerp(Color3.fromRGB(255, 255, 255), 0.5))
        }),
        Parent = separator
    })
    
    -- Animar gradiente
    spawn(function()
        local offset = 0
        while separator.Parent do
            offset = offset + 0.008
            if offset > 1 then offset = 0 end
            gradient.Offset = Vector2.new(offset, 0)
            wait(0.03)
        end
    end)
    
    return separator
end

-- Nuevo: Crear tarjeta con efecto de elevación
function Utility:CreateElevatedCard(parent, size, position, cornerRadius)
    local card = self:Create("Frame", {
        BackgroundColor3 = PRIMARY_COLOR,
        BackgroundTransparency = TRANSPARENCY,
        BorderSizePixel = 0,
        Position = position or UDim2.new(0, 0, 0, 0),
        Size = size or UDim2.new(1, 0, 0, 100),
        Parent = parent
    })
    
    -- Bordes redondeados
    self:Create("UICorner", {
        CornerRadius = cornerRadius or CORNER_RADIUS,
        Parent = card
    })
    
    -- Sombra interna para efecto de profundidad
    local shadow = self:Create("ImageLabel", {
        Name = "Shadow",
        BackgroundTransparency = 1,
        Image = "rbxassetid://6014257812",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.8,
        Position = UDim2.fromScale(0.5, 0.5),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(1, 12, 1, 12),
        ZIndex = card.ZIndex - 1,
        Parent = card
    })
    
    -- Borde sutil
    self:Create("UIStroke", {
        Color = STROKE_COLOR,
        Thickness = STROKE_THICKNESS * 0.7,
        Transparency = 0.7,
        ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
        Parent = card
    })
    
    return card
end

-- Sistema de guardado (Mejorado con encriptación básica)
local SaveSystem = {}

-- Generar ID único para cada script
function SaveSystem:GenerateUID()
    local template = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"
    return string.gsub(template, "[xy]", function (c)
        local v = (c == "x") and math.random(0, 0xf) or math.random(8, 0xb)
        return string.format("%x", v)
    end)
end

-- Encriptar datos básicos (obfuscación simple)
function SaveSystem:EncryptData(data)
    -- Convertir a JSON
    local jsonData = HttpService:JSONEncode(data)
    
    -- Obfuscación simple (suficiente para ocultar datos de usuarios básicos)
    local encryptedData = ""
    local key = 13 -- Clave simple
    
    for i = 1, #jsonData do
        local char = string.sub(jsonData, i, i)
        local byte = string.byte(char)
        local encryptedByte = byte + key
        
        -- Rotar clave para mayor seguridad
        key = (key * 1.5 + byte) % 20 + 10
        
        encryptedData = encryptedData .. string.char(encryptedByte)
    end
    
    return encryptedData
end

-- Desencriptar datos
function SaveSystem:DecryptData(encryptedData)
    if not encryptedData then return nil end
    
    local jsonData = ""
    local key = 13 -- Misma clave inicial
    
    for i = 1, #encryptedData do
        local char = string.sub(encryptedData, i, i)
        local byte = string.byte(char)
        local decryptedByte = byte - key
        
        -- Rotar clave igual que en encriptación
        key = (key * 1.5 + decryptedByte) % 20 + 10
        
        jsonData = jsonData .. string.char(decryptedByte)
    end
    
    -- Convertir JSON a tabla
    local success, result = pcall(function()
        return HttpService:JSONDecode(jsonData)
    end)
    
    if success then
        return result
    end
    
    return nil
end

-- Guardar configuración (con encriptación)
function SaveSystem:SaveSettings(name, settings)
    if not name then return end
    
    local encryptedData = self:EncryptData(settings)
    
    if writefile then
        local folderPath = "NeonUI/"
        local fileName = folderPath .. name .. ".dat" -- Cambiar extensión para ocultar que es JSON
        
        if not isfolder(folderPath) then
            makefolder(folderPath)
        end
        
        writefile(fileName, encryptedData)
        return true
    end
    
    return false
end

-- Cargar configuración (con desencriptación)
function SaveSystem:LoadSettings(name)
    if not name then return end
    
    local folderPath = "NeonUI/"
    local fileName = folderPath .. name .. ".dat"
    
    if readfile and isfile and isfile(fileName) then
        local encryptedData = readfile(fileName)
        return self:DecryptData(encryptedData)
    end
    
    return nil
end

-- NeonUI principal
local NeonUI = {
    Windows = {},
    Theme = {
        Primary = PRIMARY_COLOR,
        Secondary = SECONDARY_COLOR,
        Accent = ACCENT_COLOR,
        Text = TEXT_COLOR,
        Stroke = STROKE_COLOR,
        Glow = GLOW_COLOR,
        Transparency = TRANSPARENCY,
        CornerRadius = CORNER_RADIUS,
        Font = FONT,
        FontSize = FONT_SIZE
    },
    Flags = {},
    Version = "3.1.0",
    IsMobile = isMobile,
    Scale = SCALE_FACTOR
}

-- Inicialización de la UI
function NeonUI:Init()
    -- Destruir GUI existente si existe
    if getgenv().NeonUIObject then
        getgenv().NeonUIObject:Destroy()
    end
    
    -- Crear contenedor principal
    self.Container = Utility:Create("ScreenGui", {
        Name = "NeonUI",
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false
    })
    
    -- Establecer el parent con la protección adecuada
    if gethui then
        self.Container.Parent = gethui()
    elseif syn and syn.protect_gui then
        syn.protect_gui(self.Container)
        self.Container.Parent = CoreGui
    else
        self.Container.Parent = CoreGui
    end
    
    getgenv().NeonUIObject = self.Container
    
    -- Notificación de inicio
    self:Notify({
        Title = "NeonUI " .. self.Version,
        Content = "Biblioteca inicializada correctamente" .. (isMobile and " [Modo Móvil]" or " [Modo PC]"),
        Duration = 3
    })
    
    return self
end

-- Sistema de notificaciones mejorado con tema lava
function NeonUI:Notify(options)
    options = options or {}
    local notification = {
        Title = options.Title or "Notification",
        Content = options.Content or "",
        Duration = options.Duration or 5
    }
    
    -- Factor de escala para móvil
    local scale = isMobile and 1.2 or 1.0
    local notifWidth = 280 * scale
    local notifHeight = 80 * scale
    
    -- Marco principal de notificación
    local notifFrame = Utility:Create("Frame", {
        Name = "Notification",
        BackgroundColor3 = self.Theme.Primary,
        BackgroundTransparency = self.Theme.Transparency,
        BorderSizePixel = 0,
        Position = UDim2.new(1, -20, 1, -20),
        AnchorPoint = Vector2.new(1, 1),
        Size = UDim2.new(0, notifWidth, 0, notifHeight),
        Parent = self.Container
    })
    
    -- Bordes redondeados
    Utility:Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = notifFrame
    })
    
    -- Sombra para elevación
    local shadow = Utility:Create("ImageLabel", {
        Name = "Shadow",
        BackgroundTransparency = 1,
        Image = "rbxassetid://6014257812",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.6,
        Position = UDim2.fromScale(0.5, 0.5),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(1, 24, 1, 24),
        ZIndex = notifFrame.ZIndex - 1,
        Parent = notifFrame
    })
    
    -- Borde sutil con efecto de brillo
    local stroke = Utility:Create("UIStroke", {
        Color = self.Theme.Accent,
        Thickness = 1.5,
        Transparency = 0.7,
        ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
        Parent = notifFrame
    })
    
    -- Animar el borde
    spawn(function()
        local t = 0
        while notifFrame.Parent do
            t = t + 0.03
            stroke.Transparency = 0.7 + math.sin(t * 3) * 0.2
            wait(0.03)
        end
    end)
    
    -- Gradiente para efecto lava
    local gradient = Utility:Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, self.Theme.Primary),
            ColorSequenceKeypoint.new(0.5, self.Theme.Primary:Lerp(self.Theme.Secondary, 0.5)),
            ColorSequenceKeypoint.new(1, self.Theme.Secondary)
        }),
        Rotation = 90,
        Parent = notifFrame
    })
    
    -- Animar gradiente
    spawn(function()
        local offset = 0
        while notifFrame.Parent do
            offset = offset + 0.01
            if offset > 1 then offset = 0 end
            gradient.Offset = Vector2.new(0, offset)
            wait(0.03)
        end
    end)
    
    -- Partículas de lava
    Utility:CreateLavaParticles(notifFrame, 6)
    
    -- Barra de acento
    local accentBar = Utility:Create("Frame", {
        Name = "AccentBar",
        BackgroundColor3 = self.Theme.Accent,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(0, 4, 1, 0),
        Parent = notifFrame
    })
    
    -- Bordes redondeados para barra
    Utility:Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = accentBar
    })
    
    -- Título
    local titleLabel = Utility:Create("TextLabel", {
        Name = "Title",
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(12, 8),
        Size = UDim2.new(1, -50, 0, 24),
        Font = self.Theme.Font,
        Text = notification.Title,
        TextColor3 = self.Theme.Text,
        TextSize = self.Theme.FontSize + 2,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = notifFrame
    })
    
    -- Gradiente para el título
    Utility:Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, self.Theme.Text),
            ColorSequenceKeypoint.new(1, self.Theme.Accent)
        }),
        Parent = titleLabel
    })
    
    -- Contenido
    local contentLabel = Utility:Create("TextLabel", {
        Name = "Content",
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(12, 32),
        Size = UDim2.new(1, -24, 0, 40),
        Font = self.Theme.Font,
        Text = notification.Content,
        TextColor3 = Color3.fromRGB(220, 220, 220),
        TextSize = self.Theme.FontSize - 1,
        TextWrapped = true,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        Parent = notifFrame
    })
    
    -- Botón de cerrar
    local closeButton = Utility:Create("ImageButton", {
        Name = "CloseButton",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -24, 0, 8),
        Size = UDim2.fromOffset(16, 16),
        Image = "rbxassetid://7733717447",
        ImageColor3 = self.Theme.Accent,
        Parent = notifFrame
    })
    
    -- Barra de progreso
    local progressBar = Utility:Create("Frame", {
        Name = "ProgressBar",
        BackgroundColor3 = self.Theme.Accent,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, -2),
        Size = UDim2.new(1, 0, 0, 2),
        Parent = notifFrame
    })
    
    -- Añadir gradiente a barra de progreso
    local progressGradient = Utility:Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, self.Theme.Accent),
            ColorSequenceKeypoint.new(1, self.Theme.Accent:Lerp(Color3.fromRGB(255,255,255), 0.3))
        }),
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 0),
            NumberSequenceKeypoint.new(1, 0.4)
        }),
        Parent = progressBar
    })
    
    -- Añadir brillo al progreso
    spawn(function()
        local t = 0
        while progressBar.Parent do
            t = t + 0.05
            progressGradient.Offset = Vector2.new(math.sin(t) * 0.5, 0)
            wait(0.03)
        end
    end)
    
    -- Animación de entrada con rebote suave
    notifFrame.Position = UDim2.new(1, 300, 1, -20)
    notifFrame.Visible = true
    
    -- Animar entrada
    Utility:Tween(notifFrame, {Position = UDim2.new(1, -20, 1, -20)}, 0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    
    -- Barra de progreso
    Utility:Tween(progressBar, {Size = UDim2.new(0, 0, 0, 2)}, notification.Duration, Enum.EasingStyle.Linear)
    
    -- Evento de cerrar
    closeButton.MouseButton1Click:Connect(function()
        -- Efecto de pulsación
        Utility:Tween(closeButton, {Size = UDim2.fromOffset(14, 14)}, 0.1, Enum.EasingStyle.Quad)
        task.wait(0.1)
        Utility:Tween(closeButton, {Size = UDim2.fromOffset(16, 16)}, 0.1, Enum.EasingStyle.Quad)
        task.wait(0.1)
        
        Utility:Tween(notifFrame, {Position = UDim2.new(1, 300, 1, -20), Transparency = 1}, 0.4, Enum.EasingStyle.Quint)
        task.wait(0.4)
        notifFrame:Destroy()
    end)
    
    -- Auto cerrar después de la duración
    task.delay(notification.Duration, function()
        if notifFrame and notifFrame.Parent then
            Utility:Tween(notifFrame, {Position = UDim2.new(1, 300, 1, -20), Transparency = 1}, 0.4, Enum.EasingStyle.Quint)
            task.wait(0.4)
            notifFrame:Destroy()
        end
    end)
    
    return notifFrame
end

-- Diálogo modal con tema lava
function NeonUI:Dialog(options)
    options = options or {}
    local dialog = {
        Title = options.Title or "Dialog",
        Content = options.Content or "",
        Buttons = options.Buttons or {{Title = "OK", Callback = function() end}}
    }
    
    -- Factor de escala para móvil
    local scale = isMobile and 1.2 or 1.0
    local dialogWidth = 320 * scale
    local dialogHeight = 180 * scale
    
    -- Overlay de fondo con difuminado
    local overlay = Utility:Create("Frame", {
        Name = "DialogOverlay",
        BackgroundColor3 = Color3.fromRGB(0, 0, 0),
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Position = UDim2.fromScale(0, 0),
        Size = UDim2.fromScale(1, 1),
        ZIndex = 100,
        Parent = self.Container
    })
    
    -- Efecto de difuminado (blur)
    local blur = Utility:Create("BlurEffect", {
        Size = 0,
        Parent = game:GetService("Lighting")
    })
    
    -- Animar aparición del blur
    Utility:Tween(blur, {Size = 10}, 0.3)
    
    -- Marco de diálogo
    local dialogFrame = Utility:Create("Frame", {
        Name = "DialogFrame",
        BackgroundColor3 = self.Theme.Primary,
        BackgroundTransparency = self.Theme.Transparency,
        BorderSizePixel = 0,
        Position = UDim2.fromScale(0.5, 0.5),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.fromOffset(0, 0), -- Comienza en tamaño cero para animación
        ZIndex = 101,
        Parent = overlay
    })
    
    -- Bordes redondeados
    Utility:Create("UICorner", {
        CornerRadius = UDim.new(0, 10),
        Parent = dialogFrame
    })
    
    -- Sombra para elevación
    local shadow = Utility:Create("ImageLabel", {
        Name = "Shadow",
        BackgroundTransparency = 1,
        Image = "rbxassetid://6014257812",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.5,
        Position = UDim2.fromScale(0.5, 0.5),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(1, 40, 1, 40),
        ZIndex = dialogFrame.ZIndex - 1,
        Parent = dialogFrame
    })
    
    -- Agregar gradiente para efecto lava
    local gradient = Utility:Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, self.Theme.Primary),
            ColorSequenceKeypoint.new(0.5, self.Theme.Primary:Lerp(self.Theme.Secondary, 0.5)),
            ColorSequenceKeypoint.new(1, self.Theme.Secondary)
        }),
        Rotation = 90,
        Parent = dialogFrame
    })
    
    -- Animar gradiente
    spawn(function()
        local offset = 0
        while dialogFrame.Parent do
            offset = offset + 0.01
            if offset > 1 then offset = 0 end
            gradient.Offset = Vector2.new(0, offset)
            wait(0.03)
        end
    end)
    
    -- Añadir partículas de lava
    Utility:CreateLavaParticles(dialogFrame, 8)
    
    -- Borde interior brillante
    local innerBorder = Utility:Create("UIStroke", {
        Color = self.Theme.Accent,
        Thickness = 1.5,
        Transparency = 0.7,
        ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
        Parent = dialogFrame
    })
    
    -- Animar el borde
    spawn(function()
        local t = 0
        while innerBorder.Parent do
            t = t + 0.03
            innerBorder.Transparency = 0.7 + math.sin(t * 3) * 0.2
            wait(0.03)
        end
    end)
    
    -- Título
    local titleLabel = Utility:Create("TextLabel", {
        Name = "Title",
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(20, 15),
        Size = UDim2.new(1, -40, 0, 30),
        Font = self.Theme.Font,
        Text = dialog.Title,
        TextColor3 = self.Theme.Text,
        TextSize = self.Theme.FontSize + 6,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 102,
        Parent = dialogFrame
    })
    
    -- Gradiente para el título
    Utility:Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, self.Theme.Text),
            ColorSequenceKeypoint.new(1, self.Theme.Accent)
        }),
        Parent = titleLabel
    })
    
    -- Separador dinámico
    Utility:CreateDynamicSeparator(dialogFrame, titleLabel, self.Theme.Accent, 35, 0.6)
    
    -- Contenido
    local contentLabel = Utility:Create("TextLabel", {
        Name = "Content",
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(20, 60),
        Size = UDim2.new(1, -40, 0, 70),
        Font = self.Theme.Font,
        Text = dialog.Content,
        TextColor3 = Color3.fromRGB(230, 230, 230),
        TextSize = self.Theme.FontSize,
        TextWrapped = true,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        ZIndex = 102,
        Parent = dialogFrame
    })
    
    -- Contenedor de botones
    local buttonContainer = Utility:Create("Frame", {
        Name = "ButtonContainer",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 1, -60),
        Size = UDim2.new(1, 0, 0, 50),
        ZIndex = 102,
        Parent = dialogFrame
    })
    
    -- Layout para botones
    Utility:Create("UIListLayout", {
        Padding = UDim.new(0, 15),
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = buttonContainer
    })
    
    -- Crear botones
    for i, buttonInfo in ipairs(dialog.Buttons) do
        local button = Utility:Create("TextButton", {
            Name = "Button_" .. i,
            BackgroundColor3 = self.Theme.Accent,
            BorderSizePixel = 0,
            Size = UDim2.new(0, 110 * scale, 0, 36 * scale),
            Font = self.Theme.Font,
            Text = buttonInfo.Title,
            TextColor3 = Color3.fromRGB(255, 255, 255),
            TextSize = self.Theme.FontSize + 2,
            ZIndex = 103,
            Parent = buttonContainer
        })
        
        -- Bordes redondeados para botón
        Utility:Create("UICorner", {
            CornerRadius = UDim.new(0, 6),
            Parent = button
        })
        
        -- Gradiente para el botón
        local buttonGradient = Utility:Create("UIGradient", {
            Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, self.Theme.Accent),
                ColorSequenceKeypoint.new(0.5, self.Theme.Accent:Lerp(Color3.new(1,1,1), 0.2)),
                ColorSequenceKeypoint.new(1, self.Theme.Accent)
            }),
            Rotation = 45,
            Parent = button
        })
        
        -- Brillo para el botón
        Utility:CreateGlow(button, self.Theme.Glow, 1.2)
        
        -- Evento de clic
        button.MouseButton1Click:Connect(function()
            -- Efecto ripple
            Utility:Ripple(button)
            
            -- Animación de pulsación
            Utility:Tween(button, {Size = UDim2.new(0, 105 * scale, 0, 34 * scale)}, 0.1, Enum.EasingStyle.Quad)
            task.wait(0.1)
            Utility:Tween(button, {Size = UDim2.new(0, 110 * scale, 0, 36 * scale)}, 0.1, Enum.EasingStyle.Quad)
            
            -- Ejecutar callback
            if buttonInfo.Callback then
                buttonInfo.Callback()
            end
            
            -- Animación de cierre
            Utility:Tween(blur, {Size = 0}, 0.3)
            Utility:Tween(dialogFrame, {Size = UDim2.fromOffset(0, 0), Position = UDim2.fromScale(0.5, 0.5)}, 0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In)
            Utility:Tween(overlay, {BackgroundTransparency = 1}, 0.4)
            task.wait(0.4)
            blur:Destroy()
            overlay:Destroy()
        end)
        
        -- Efectos de hover
        button.MouseEnter:Connect(function()
            Utility:Tween(button, {
                BackgroundColor3 = self.Theme.Accent:Lerp(Color3.new(1,1,1), 0.2),
                Size = UDim2.new(0, 114 * scale, 0, 38 * scale)
            }, 0.2, Enum.EasingStyle.Quad)
        end)
        
        button.MouseLeave:Connect(function()
            Utility:Tween(button, {
                BackgroundColor3 = self.Theme.Accent,
                Size = UDim2.new(0, 110 * scale, 0, 36 * scale)
            }, 0.2, Enum.EasingStyle.Quad)
        end)
    end
    
    -- Animación de apertura
    overlay.BackgroundTransparency = 1
    Utility:Tween(overlay, {BackgroundTransparency = 0.5}, 0.3)
    Utility:Tween(dialogFrame, {Size = UDim2.fromOffset(dialogWidth, dialogHeight)}, 0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    
    return dialog
end

-- Obtener icono desde nombre
function NeonUI:GetIcon(name)
    local icons = {
        home = "7733960981",
        settings = "7734053495",
        user = "7743871002",
        star = "7734068321",
        warning = "7734036668",
        info = "7734010138",
        plus = "7734056604",
        minus = "7734062493",
        search = "7734093360",
        box = "7734155436",
        folder = "7734172055",
        chevron = "7734238686",
        gear = "7734053495",
        bell = "7743855514",
        heart = "7733718216",
        bookmark = "7743895266",
        moon = "7743878047",
        sun = "7733920644",
        cloud = "7733821549",
        globe = "7733778299",
        lock = "7733885257",
        unlock = "7733726102",
        key = "7733832079",
        flag = "7733777611",
        trash = "7733673941",
        edit = "7733799486",
        pencil = "7733696245",
        image = "7733946818",
        video = "7733709455",
        music = "7733656793",
        mic = "7733839766",
        phone = "7733790917",
        mail = "7733889662",
        send = "7733745099",
        code = "7733944826",
        terminal = "7733794336",
        link = "7733865183",
        coffee = "7733951482",
        file = "7733791228",
        archive = "7743824158",
        layers = "7733859130",
        compass = "7733857969",
        map = "7733837011",
        ["map-pin"] = "7733824551",
        award = "7743823882",
        upload = "7734172322",
        download = "7733982464",
        camera = "7733930958",
        play = "7743985991",
        pause = "7733904064",
        stop = "7733754058",
        message = "7733873146",
        users = "7734095912",
        activity = "7743823554",
        alert = "7743824019",
        eye = "7733760318",
        ["eye-off"] = "7743877488",
        gitlab = "7733897366",
        github = "7733873313",
        calendar = "7733812303",
        paperclip = "7733903117",
        scissors = "7734142322",
        tag = "7734197488",
        tags = "7733980420",
        tool = "7733928794",
        ["bar-chart"] = "7743825153",
        ["pie-chart"] = "7743883343",
        ["line-chart"] = "7743880222",
        zap = "7733679869",
        check = "7733956746",
        ["x"] = "7733717447",
        sliders = "7734176202",
        target = "7734226711",
        shield = "7734231071",
        sword = "7743915270",
        wifi = "7734114676",
        bluetooth = "7733768238",
        share = "7734181035",
        printer = "7733913543",
        cpu = "7733929456",
        speaker = "7734052733",
        tv = "7733766052",
        ["log-out"] = "7733978918",
        ["log-in"] = "7733923449",
        fire = "9835862639",  -- Icono de fuego para tema lava
        explosion = "9835868665", -- Explosión para tema lava
        flame = "9835865192",    -- Llama para tema lava
        volcano = "9482093348"   -- Volcán para tema lava
    }
    
    return icons[name:lower()] or "7733717447" -- Default to X icon
end

-- Crear ventana principal (mejorada)
function NeonUI:CreateWindow(options)
    options = options or {}
    local window = {
        Title = options.Title or "NeonUI",
        SubTitle = options.SubTitle or "",
        Size = options.Size or UDim2.fromOffset(isMobile and 320 * SCALE_FACTOR or 550, isMobile and 450 * SCALE_FACTOR or 400),
        Position = options.Position or UDim2.fromScale(0.5, 0.5),
        Theme = options.Theme or "Lava",
        Tabs = {},
        TabsFrame = nil,
        TabsContainer = nil,
        ContentContainer = nil,
        CurrentTab = nil,
        Settings = {},
        Flags = {},
        Minimized = false -- Para seguimiento del estado
    }
    
    -- Aplicar tema
    if window.Theme == "Dark" then
        self.Theme.Primary = Color3.fromRGB(30, 33, 34)
        self.Theme.Secondary = Color3.fromRGB(45, 50, 52)
    elseif window.Theme == "Light" then
        self.Theme.Primary = Color3.fromRGB(240, 240, 240)
        self.Theme.Secondary = Color3.fromRGB(255, 255, 255)
        self.Theme.Text = Color3.fromRGB(50, 50, 50)
    elseif window.Theme == "Midnight" then
        self.Theme.Primary = Color3.fromRGB(22, 24, 35)
        self.Theme.Secondary = Color3.fromRGB(30, 33, 45)
    elseif window.Theme == "Nebula" then
        self.Theme.Primary = Color3.fromRGB(30, 20, 45)
        self.Theme.Secondary = Color3.fromRGB(40, 28, 65)
        self.Theme.Accent = Color3.fromRGB(165, 82, 255)
    elseif window.Theme == "Lava" then
        self.Theme.Primary = PRIMARY_COLOR
        self.Theme.Secondary = SECONDARY_COLOR
        self.Theme.Accent = ACCENT_COLOR
        self.Theme.Glow = GLOW_COLOR
        self.Theme.Stroke = STROKE_COLOR
    end
    
    -- Ajustes para tamaño y posición inicial
    local initialSize = UDim2.new(0, 0, 0, 0)
    local targetSize = window.Size
    
    -- Crear ventana principal con efecto de elevación
    window.Frame = Utility:Create("Frame", {
        Name = "WindowFrame",
        BackgroundColor3 = self.Theme.Primary,
        BackgroundTransparency = self.Theme.Transparency,
        BorderSizePixel = 0,
        Position = UDim2.fromScale(0.5, 0.5),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = initialSize,
        Parent = self.Container
    })
    
    -- Bordes redondeados
    Utility:Create("UICorner", {
        CornerRadius = self.Theme.CornerRadius,
        Parent = window.Frame
    })
    
    -- Efecto de sombra
    local shadow = Utility:Create("ImageLabel", {
        Name = "Shadow",
        BackgroundTransparency = 1,
        Image = "rbxassetid://6014257812",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.6,
        Position = UDim2.fromScale(0.5, 0.5),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(1, 30, 1, 30),
        ZIndex = window.Frame.ZIndex - 1,
        Parent = window.Frame
    })
    
    -- Agregar gradiente para efecto lava
    if window.Theme == "Lava" then
        local gradient = Utility:Create("UIGradient", {
            Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, self.Theme.Primary),
                ColorSequenceKeypoint.new(0.5, self.Theme.Primary:Lerp(self.Theme.Secondary, 0.5)),
                ColorSequenceKeypoint.new(1, self.Theme.Secondary)
            }),
            Rotation = 90,
            Parent = window.Frame
        })
        
        -- Animar gradiente
        spawn(function()
            local offset = 0
            while window.Frame.Parent do
                offset = offset + 0.005
                if offset > 1 then offset = 0 end
                gradient.Offset = Vector2.new(0, offset)
                wait(0.03)
            end
        end)
        
        -- Agregar partículas de lava al fondo
        Utility:CreateLavaParticles(window.Frame, isMobile and 8 or 12)
        
        -- Borde interior brillante
        local innerBorder = Utility:Create("UIStroke", {
            Color = self.Theme.Accent,
            Thickness = 1.5,
            Transparency = 0.7,
            ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
            Parent = window.Frame
        })
        
        -- Animar el borde
        spawn(function()
            local t = 0
            while innerBorder.Parent do
                t = t + 0.03
                innerBorder.Transparency = 0.7 + math.sin(t * 3) * 0.15
                wait(0.05)
            end
        end)
    end
    
    -- Barra de título con efecto de elevación
    window.TitleBar = Utility:Create("Frame", {
        Name = "TitleBar",
        BackgroundColor3 = self.Theme.Secondary,
        BackgroundTransparency = self.Theme.Transparency,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 40),
        Parent = window.Frame
    })
    
    -- Bordes redondeados para la barra de título
    Utility:Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = window.TitleBar
    })
    
    -- Si es tema lava, agregar gradient y arreglar esquinas
    if window.Theme == "Lava" then
        -- Gradient para la barra de título
        local titleGradient = Utility:Create("UIGradient", {
            Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, self.Theme.Secondary:Lerp(self.Theme.Accent, 0.1)),
                ColorSequenceKeypoint.new(0.5, self.Theme.Secondary),
                ColorSequenceKeypoint.new(1, self.Theme.Secondary:Lerp(self.Theme.Accent, 0.05))
            }),
            Rotation = 90,
            Parent = window.TitleBar
        })
        
        -- Fijar esquinas inferiores
        local bottomFixFrame = Utility:Create("Frame", {
            Name = "BottomFixFrame",
            BackgroundColor3 = self.Theme.Secondary,
            BackgroundTransparency = self.Theme.Transparency,
            BorderSizePixel = 0,
            Position = UDim2.new(0, 0, 1, -10),
            Size = UDim2.new(1, 0, 0, 10),
            ZIndex = window.TitleBar.ZIndex,
            Parent = window.TitleBar
        })
        
        -- Copiar gradiente
        titleGradient:Clone().Parent = bottomFixFrame
    end
    
    -- Título mejorado
    window.TitleText = Utility:Create("TextLabel", {
        Name = "Title",
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(15, 0),
        Size = UDim2.new(1, -30, 1, 0),
        Font = self.Theme.Font,
        Text = window.Theme == "Lava" and "🔥 " .. window.Title or window.Title,
        TextColor3 = self.Theme.Text,
        TextSize = self.Theme.FontSize + 4,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = window.TitleBar
    })
    
    -- Si es tema lava, añadir gradient al texto
    if window.Theme == "Lava" then
        Utility:Create("UIGradient", {
            Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, self.Theme.Text),
                ColorSequenceKeypoint.new(1, self.Theme.Accent)
            }),
            Parent = window.TitleText
        })
    end
    
    -- Subtítulo
    if window.SubTitle and window.SubTitle ~= "" then
        window.SubTitleText = Utility:Create("TextLabel", {
            Name = "SubTitle",
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 15, 0, 24),
            Size = UDim2.new(1, -30, 0, 16),
            Font = self.Theme.Font,
            Text = window.SubTitle,
            TextColor3 = Color3.fromRGB(200, 200, 200),
            TextSize = self.Theme.FontSize - 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = window.TitleBar
        })
        
        window.TitleText.Position = UDim2.fromOffset(15, 4)
        window.TitleText.Size = UDim2.new(1, -30, 0, 20)
    end
    
    -- Botón de cerrar mejorado
    window.CloseButton = Utility:Create("ImageButton", {
        Name = "CloseButton",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -32, 0, 10),
        Size = UDim2.fromOffset(20, 20),
        Image = "rbxassetid://7733717447",
        ImageColor3 = window.Theme == "Lava" and self.Theme.Accent or Color3.fromRGB(230, 230, 230),
        Parent = window.TitleBar
    })
    
    -- Botón de minimizar mejorado
    window.MinimizeButton = Utility:Create("ImageButton", {
        Name = "MinimizeButton",
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -58, 0, 10),
        Size = UDim2.fromOffset(20, 20),
        Image = "rbxassetid://7733774602",
        ImageColor3 = window.Theme == "Lava" and self.Theme.Accent or Color3.fromRGB(230, 230, 230),
        Parent = window.TitleBar
    })
    
    -- Botón flotante para cuando está minimizado
    window.FloatingButton = Utility:Create("ImageButton", {
        Name = "FloatingButton",
        BackgroundColor3 = self.Theme.Accent,
        BackgroundTransparency = 0.1,
        BorderSizePixel = 0,
        Position = UDim2.new(0.85, 0, 0.8, 0),
        Size = UDim2.fromOffset(0, 0), -- Comienza en tamaño cero para animación
        Image = "rbxassetid://9835862639", -- Icono de fuego
        ImageColor3 = Color3.fromRGB(255, 255, 255),
        Visible = false,
        Parent = self.Container,
        ZIndex = 1000
    })
    
    -- Bordes redondeados para botón flotante
    Utility:Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = window.FloatingButton
    })
    
    -- Sombra para botón flotante
    local floatingShadow = Utility:Create("ImageLabel", {
        Name = "Shadow",
        BackgroundTransparency = 1,
        Image = "rbxassetid://6014257812",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.3,
        Position = UDim2.fromScale(0.5, 0.5),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(1, 20, 1, 20),
        ZIndex = window.FloatingButton.ZIndex - 1,
        Parent = window.FloatingButton
    })
    
    -- Brillo para el botón flotante
    Utility:CreateGlow(window.FloatingButton, self.Theme.Glow, 1.3)
    
    -- Hacer arrastrable el botón flotante
    Utility:Draggable(window.FloatingButton, window.FloatingButton)
    
    -- Funcionalidad de arrastrar ventana
    Utility:Draggable(window.Frame, window.TitleBar)
    
    -- Contenedor de tabs mejorado
    window.TabsFrame = Utility:Create("Frame", {
        Name = "TabsFrame",
        BackgroundColor3 = self.Theme.Secondary,
        BackgroundTransparency = self.Theme.Transparency,
        BorderSizePixel = 0,
        Position = UDim2.fromOffset(12, 52),
        Size = UDim2.new(0, 140 * SCALE_FACTOR, 1, -64),
        Parent = window.Frame
    })
    
    -- Bordes redondeados para tabs
    Utility:Create("UICorner", {
        CornerRadius = self.Theme.CornerRadius,
        Parent = window.TabsFrame
    })
    
    -- Si es tema lava, añadir efectos
    if window.Theme == "Lava" then
        Utility:Create("UIGradient", {
            Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, self.Theme.Secondary:Lerp(self.Theme.Primary, 0.3)),
                ColorSequenceKeypoint.new(0.5, self.Theme.Secondary),
                ColorSequenceKeypoint.new(1, self.Theme.Secondary:Lerp(self.Theme.Primary, 0.3))
            }),
            Rotation = 90,
            Parent = window.TabsFrame
        })
        
        -- Borde interior
        Utility:Create("UIStroke", {
            Color = self.Theme.Accent,
            Thickness = 1,
            Transparency = 0.8,
            ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
            Parent = window.TabsFrame
        })
    end
    
    -- ScrollFrame para tabs mejorado
    window.TabsScrollFrame = Utility:Create("ScrollingFrame", {
        Name = "TabsScrollFrame",
        Active = true,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Position = UDim2.fromOffset(0, 10),
        Size = UDim2.new(1, 0, 1, -20),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = self.Theme.Accent,
        Parent = window.TabsFrame
    })
    
    -- Lista de tabs
    Utility:Create("UIListLayout", {
        Padding = UDim.new(0, 8),
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = window.TabsScrollFrame
    })
    
    -- Padding para tabs
    Utility:Create("UIPadding", {
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        PaddingTop = UDim.new(0, 8),
        PaddingBottom = UDim.new(0, 8),
        Parent = window.TabsScrollFrame
    })
    
    -- Contenedor de contenido mejorado
    window.ContentFrame = Utility:Create("Frame", {
        Name = "ContentFrame",
        BackgroundColor3 = self.Theme.Secondary,
        BackgroundTransparency = self.Theme.Transparency,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 164 * SCALE_FACTOR, 0, 52),
        Size = UDim2.new(1, -176 * SCALE_FACTOR, 1, -64),
        Parent = window.Frame
    })
    
    -- Bordes redondeados para contenido
    Utility:Create("UICorner", {
        CornerRadius = self.Theme.CornerRadius,
        Parent = window.ContentFrame
    })
    
    -- Si es tema lava, añadir efectos
    if window.Theme == "Lava" then
        Utility:Create("UIGradient", {
            Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, self.Theme.Secondary:Lerp(self.Theme.Primary, 0.2)),
                ColorSequenceKeypoint.new(0.5, self.Theme.Secondary),
                ColorSequenceKeypoint.new(1, self.Theme.Secondary:Lerp(self.Theme.Primary, 0.2))
            }),
            Rotation = 90,
            Parent = window.ContentFrame
        })
        
        -- Borde interior
        Utility:Create("UIStroke", {
            Color = self.Theme.Accent,
            Thickness = 1,
            Transparency = 0.8,
            ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
            Parent = window.ContentFrame
        })
    end
    
    -- Funcionalidad de los botones
    window.CloseButton.MouseButton1Click:Connect(function()
        -- Efecto de pulsación
        Utility:Tween(window.CloseButton, {Size = UDim2.fromOffset(18, 18)}, 0.1, Enum.EasingStyle.Quad)
        task.wait(0.1)
        Utility:Tween(window.CloseButton, {Size = UDim2.fromOffset(20, 20)}, 0.1, Enum.EasingStyle.Quad)
        task.wait(0.1)
        
        -- Cierre con animación
        local centerPos = UDim2.fromScale(0.5, 0.5)
        
        if window.FloatingButton.Visible then
            Utility:Tween(window.FloatingButton, {Size = UDim2.fromOffset(0, 0)}, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In)
        end
        
        Utility:Tween(window.Frame, {Size = UDim2.fromOffset(0, 0), Position = centerPos}, 0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In)
        task.wait(0.4)
        self.Container:Destroy()
    end)
    
    -- Función mejorada para minimizar/maximizar
    function window:ToggleMinimize()
        window.Minimized = not window.Minimized
        
        if window.Minimized then
            -- Guardar tamaño original para restaurar después
            window.OriginalSize = window.Frame.Size
            
            -- Minimizar con animación
            Utility:Tween(window.Frame, {Size = UDim2.new(1, 0, 0, 40)}, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In)
            
            -- Mostrar botón flotante después de un pequeño retraso
            task.delay(0.3, function()
                window.FloatingButton.Visible = true
                window.FloatingButton.Size = UDim2.fromOffset(0, 0)
                Utility:Tween(window.FloatingButton, {Size = UDim2.fromOffset(50 * SCALE_FACTOR, 50 * SCALE_FACTOR)}, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
                
                -- Añadir ligero rebote al botón flotante
                task.delay(0.3, function()
                    Utility:Tween(window.FloatingButton, {Size = UDim2.fromOffset(46 * SCALE_FACTOR, 46 * SCALE_FACTOR)}, 0.1)
                    task.delay(0.1, function()
                        Utility:Tween(window.FloatingButton, {Size = UDim2.fromOffset(48 * SCALE_FACTOR, 48 * SCALE_FACTOR)}, 0.1)
                    end)
                end)
            end)
        else
            -- Maximizar con animación
            Utility:Tween(window.Frame, {Size = window.OriginalSize or window.Size}, 0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
            
            -- Ocultar botón flotante
            Utility:Tween(window.FloatingButton, {Size = UDim2.fromOffset(0, 0)}, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In)
            task.delay(0.3, function()
                window.FloatingButton.Visible = false
            end)
        end
    end
    
    -- Evento de botón de minimizar
    window.MinimizeButton.MouseButton1Click:Connect(function()
        -- Efecto de pulsación
        Utility:Tween(window.MinimizeButton, {Size = UDim2.fromOffset(18, 18)}, 0.1, Enum.EasingStyle.Quad)
        task.wait(0.1)
        Utility:Tween(window.MinimizeButton, {Size = UDim2.fromOffset(20, 20)}, 0.1, Enum.EasingStyle.Quad)
        task.wait(0.1)
        
        window:ToggleMinimize()
    end)
    
    -- Evento de botón flotante con efecto ripple
    window.FloatingButton.MouseButton1Click:Connect(function()
        Utility:Ripple(window.FloatingButton, Color3.fromRGB(255, 255, 255))
        window:ToggleMinimize()
    end)
    
    -- Efectos de hover para botones de la barra de título
    window.CloseButton.MouseEnter:Connect(function()
        Utility:Tween(window.CloseButton, {ImageColor3 = Color3.fromRGB(255, 100, 100)}, 0.2)
    end)
    
    window.CloseButton.MouseLeave:Connect(function()
        Utility:Tween(window.CloseButton, {ImageColor3 = window.Theme == "Lava" and self.Theme.Accent or Color3.fromRGB(230, 230, 230)}, 0.2)
    end)
    
    window.MinimizeButton.MouseEnter:Connect(function()
        Utility:Tween(window.MinimizeButton, {ImageColor3 = Color3.fromRGB(255, 200, 100)}, 0.2)
    end)
    
    window.MinimizeButton.MouseLeave:Connect(function()
        Utility:Tween(window.MinimizeButton, {ImageColor3 = window.Theme == "Lava" and self.Theme.Accent or Color3.fromRGB(230, 230, 230)}, 0.2)
    end)
    
    -- Métodos de ventana
    function window:AddTab(options)
        options = options or {}
        local tab = {
            Title = options.Title or "Tab",
            Icon = options.Icon,
            Sections = {},
            Elements = {}
        }
        
        -- Botón del tab mejorado
        tab.Button = Utility:Create("TextButton", {
            Name = options.Title .. "Tab",
            AutoButtonColor = false,
            BackgroundColor3 = NeonUI.Theme.Primary,
            BackgroundTransparency = NeonUI.Theme.Transparency,
            BorderSizePixel = 0,
            Size = UDim2.new(1, 0, 0, 40),
            Font = NeonUI.Theme.Font,
            Text = "",
            TextColor3 = NeonUI.Theme.Text,
            TextSize = NeonUI.Theme.FontSize,
            Parent = window.TabsScrollFrame
        })
        
        -- Bordes redondeados para botón de tab
        Utility:Create("UICorner", {
            CornerRadius = UDim.new(0, 6),
            Parent = tab.Button
        })
        
        -- Si es tema lava, añadir efectos
        if window.Theme == "Lava" then
            -- Borde sutil
            Utility:Create("UIStroke", {
                Color = NeonUI.Theme.Accent,
                Thickness = 1,
                Transparency = 0.8,
                ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
                Parent = tab.Button
            })
        end
        
        -- Icono del tab (si existe)
        if tab.Icon then
            tab.IconImage = Utility:Create("ImageLabel", {
                Name = "Icon",
                BackgroundTransparency = 1,
                Position = UDim2.fromOffset(12, 10),
                Size = UDim2.fromOffset(20, 20),
                Image = (tab.Icon:find("rbxassetid://") and tab.Icon) or ("rbxassetid://" .. NeonUI:GetIcon(tab.Icon)),
                ImageColor3 = NeonUI.Theme.Text,
                Parent = tab.Button
            })
            
            tab.TitleLabel = Utility:Create("TextLabel", {
                Name = "Title",
                BackgroundTransparency = 1,
                Position = UDim2.fromOffset(40, 0),
                Size = UDim2.new(1, -50, 1, 0),
                Font = NeonUI.Theme.Font,
                Text = tab.Title,
                TextColor3 = NeonUI.Theme.Text,
                TextSize = NeonUI.Theme.FontSize,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = tab.Button
            })
        else
            tab.TitleLabel = Utility:Create("TextLabel", {
                Name = "Title",
                BackgroundTransparency = 1,
                Position = UDim2.fromOffset(12, 0),
                Size = UDim2.new(1, -24, 1, 0),
                Font = NeonUI.Theme.Font,
                Text = tab.Title,
                TextColor3 = NeonUI.Theme.Text,
                TextSize = NeonUI.Theme.FontSize,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = tab.Button
            })
        end
        
        -- Contenedor de contenido del tab
        tab.Container = Utility:Create("ScrollingFrame", {
            Name = options.Title .. "Container",
            Active = true,
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            Position = UDim2.fromOffset(0, 0),
            Size = UDim2.new(1, 0, 1, 0),
            CanvasSize = UDim2.new(0, 0, 0, 0),
            AutomaticCanvasSize = Enum.AutomaticSize.Y,
            ScrollBarThickness = 4,
            ScrollBarImageColor3 = NeonUI.Theme.Accent,
            Visible = false,
            Parent = window.ContentFrame
        })
        
        -- Lista para elementos del tab
        Utility:Create("UIListLayout", {
            Padding = UDim.new(0, 10),
            HorizontalAlignment = Enum.HorizontalAlignment.Center,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Parent = tab.Container
        })
        
        -- Padding para elementos
        Utility:Create("UIPadding", {
            PaddingLeft = UDim.new(0, 12),
            PaddingRight = UDim.new(0, 12),
            PaddingTop = UDim.new(0, 12),
            PaddingBottom = UDim.new(0, 12),
            Parent = tab.Container
        })
        
        -- Seleccionar tab al hacer clic
        tab.Button.MouseButton1Click:Connect(function()
            -- Efecto de ripple
            Utility:Ripple(tab.Button)
            window:SelectTab(tab)
        end)
        
        -- Efectos de hover
        tab.Button.MouseEnter:Connect(function()
            if window.CurrentTab ~= tab then
                Utility:Tween(tab.Button, {BackgroundColor3 = NeonUI.Theme.Primary:Lerp(NeonUI.Theme.Accent, 0.1)}, 0.2)
            end
        end)
        
        tab.Button.MouseLeave:Connect(function()
            if window.CurrentTab ~= tab then
                Utility:Tween(tab.Button, {BackgroundColor3 = NeonUI.Theme.Primary}, 0.2)
            end
        end)
        
        -- Añadir tab a la lista
        table.insert(window.Tabs, tab)
        
        -- Auto-seleccionar el primer tab
        if #window.Tabs == 1 then
            window:SelectTab(tab)
        end
        
        -- Métodos del tab
        function tab:AddSection(options)
            options = options or {}
            local section = {
                Title = options.Title or "Section",
                Elements = {}
            }
            
            -- Contenedor de sección mejorado
            section.Container = Utility:Create("Frame", {
                Name = section.Title .. "Section",
                BackgroundColor3 = NeonUI.Theme.Primary,
                BackgroundTransparency = NeonUI.Theme.Transparency,
                BorderSizePixel = 0,
                Size = UDim2.new(1, 0, 0, 36),
                AutomaticSize = Enum.AutomaticSize.Y,
                Parent = tab.Container
            })
            
            -- Bordes redondeados para sección
            Utility:Create("UICorner", {
                CornerRadius = UDim.new(0, 8),
                Parent = section.Container
            })
            
            -- Si es tema lava, añadir efectos
            if window.Theme == "Lava" then
                -- Gradiente
                Utility:Create("UIGradient", {
                    Color = ColorSequence.new({
                        ColorSequenceKeypoint.new(0, NeonUI.Theme.Primary),
                        ColorSequenceKeypoint.new(0.5, NeonUI.Theme.Primary:Lerp(NeonUI.Theme.Secondary, 0.3)),
                        ColorSequenceKeypoint.new(1, NeonUI.Theme.Primary)
                    }),
                    Rotation = 90,
                    Parent = section.Container
                })
                
                -- Borde sutil
                Utility:Create("UIStroke", {
                    Color = NeonUI.Theme.Accent,
                    Thickness = 1.2,
                    Transparency = 0.8,
                    ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
                    Parent = section.Container
                })
            end
            
            -- Título de sección
            section.TitleLabel = Utility:Create("TextLabel", {
                Name = "Title",
                BackgroundTransparency = 1,
                Position = UDim2.fromOffset(15, 8),
                Size = UDim2.new(1, -30, 0, 24),
                Font = NeonUI.Theme.Font,
                Text = section.Title,
                TextColor3 = NeonUI.Theme.Text,
                TextSize = NeonUI.Theme.FontSize + 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = section.Container
            })
            
            -- Si es tema lava, añadir gradiente
            if window.Theme == "Lava" then
                Utility:Create("UIGradient", {
                    Color = ColorSequence.new({
                        ColorSequenceKeypoint.new(0, NeonUI.Theme.Text),
                        ColorSequenceKeypoint.new(1, NeonUI.Theme.Accent)
                    }),
                    Parent = section.TitleLabel
                })
            end
            
            -- Separador dinámico basado en el texto
            Utility:CreateDynamicSeparator(section.Container, section.TitleLabel, window.Theme == "Lava" and NeonUI.Theme.Accent or Color3.fromRGB(60, 60, 60), 30)
            
            -- Contenedor de elementos
            section.ElementsContainer = Utility:Create("Frame", {
                Name = "ElementsContainer",
                BackgroundTransparency = 1,
                BorderSizePixel = 0,
                Position = UDim2.fromOffset(0, 42),
                Size = UDim2.new(1, 0, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y,
                Parent = section.Container
            })
            
            -- Lista para elementos
            Utility:Create("UIListLayout", {
                Padding = UDim.new(0, 10),
                HorizontalAlignment = Enum.HorizontalAlignment.Center,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Parent = section.ElementsContainer
            })
            
            -- Padding para elementos
            Utility:Create("UIPadding", {
                PaddingLeft = UDim.new(0, 12),
                PaddingRight = UDim.new(0, 12),
                PaddingTop = UDim.new(0, 6),
                PaddingBottom = UDim.new(0, 12),
                Parent = section.ElementsContainer
            })
            
            -- Añadir sección a la lista
            table.insert(tab.Sections, section)
            
            -- Botón
            function section:AddButton(options)
                options = options or {}
                local button = {
                    Title = options.Title or "Button",
                    Description = options.Description,
                    Callback = options.Callback or function() end
                }
                
                -- Altura del botón (dependiendo de si tiene descripción)
                local buttonHeight = button.Description and 60 or 40
                
                -- Contenedor del botón
                button.Container = Utility:Create("Frame", {
                    Name = button.Title .. "Button",
                    BackgroundColor3 = NeonUI.Theme.Secondary,
                    BackgroundTransparency = NeonUI.Theme.Transparency,
                    BorderSizePixel = 0,
                    Size = UDim2.new(1, 0, 0, buttonHeight),
                    Parent = section.ElementsContainer
                })
                
                -- Bordes redondeados
                Utility:Create("UICorner", {
                    CornerRadius = UDim.new(0, 6),
                    Parent = button.Container
                })
                
                -- Si es tema lava, añadir efectos
                if window.Theme == "Lava" then
                    -- Gradiente
                    Utility:Create("UIGradient", {
                        Color = ColorSequence.new({
                            ColorSequenceKeypoint.new(0, NeonUI.Theme.Secondary:Lerp(NeonUI.Theme.Primary, 0.3)),
                            ColorSequenceKeypoint.new(0.5, NeonUI.Theme.Secondary),
                            ColorSequenceKeypoint.new(1, NeonUI.Theme.Secondary:Lerp(NeonUI.Theme.Primary, 0.3))
                        }),
                        Rotation = 90,
                        Parent = button.Container
                    })
                    
                    -- Borde sutil
                    Utility:Create("UIStroke", {
                        Color = NeonUI.Theme.Accent,
                        Thickness = 1,
                        Transparency = 0.8,
                        ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
                        Parent = button.Container
                    })
                end
                
                -- Botón interactivo
                button.ButtonElement = Utility:Create("TextButton", {
                    Name = "ButtonElement",
                    BackgroundColor3 = NeonUI.Theme.Accent,
                    BorderSizePixel = 0,
                    Position = UDim2.new(1, -110, 0, (buttonHeight - 30) / 2),
                    Size = UDim2.new(0, 100, 0, 30),
                    Font = NeonUI.Theme.Font,
                    Text = window.Theme == "Lava" and "CLICK" or button.Title,
                    TextColor3 = Color3.fromRGB(255, 255, 255),
                    TextSize = NeonUI.Theme.FontSize,
                    Parent = button.Container
                })
                
                -- Bordes redondeados para botón
                Utility:Create("UICorner", {
                    CornerRadius = UDim.new(0, 6),
                    Parent = button.ButtonElement
                })
                
                -- Si es tema lava, añadir efectos
                if window.Theme == "Lava" then
                    -- Agregar gradiente
                    Utility:Create("UIGradient", {
                        Color = ColorSequence.new({
                            ColorSequenceKeypoint.new(0, NeonUI.Theme.Accent),
                            ColorSequenceKeypoint.new(0.5, NeonUI.Theme.Accent:Lerp(Color3.new(1,1,1), 0.2)),
                            ColorSequenceKeypoint.new(1, NeonUI.Theme.Accent)
                        }),
                        Rotation = 45,
                        Parent = button.ButtonElement
                    })
                    
                    -- Añadir brillo
                    Utility:CreateGlow(button.ButtonElement, NeonUI.Theme.Glow, 1.2)
                end
                
                -- Título y descripción
                if button.Description then
                    button.TitleLabel = Utility:Create("TextLabel", {
                        Name = "Title",
                        BackgroundTransparency = 1,
                        Position = UDim2.fromOffset(15, 10),
                        Size = UDim2.new(1, -130, 0, 20),
                        Font = NeonUI.Theme.Font,
                        Text = button.Title,
                        TextColor3 = NeonUI.Theme.Text,
                        TextSize = NeonUI.Theme.FontSize,
                        TextXAlignment = Enum.TextXAlignment.Left,
                        Parent = button.Container
                    })
                    
                    -- Si es tema lava, añadir gradiente
                    if window.Theme == "Lava" then
                        Utility:Create("UIGradient", {
                            Color = ColorSequence.new({
                                ColorSequenceKeypoint.new(0, NeonUI.Theme.Text),
                                ColorSequenceKeypoint.new(1, NeonUI.Theme.Accent)
                            }),
                            Parent = button.TitleLabel
                        })
                    end
                    
                    button.DescriptionLabel = Utility:Create("TextLabel", {
                        Name = "Description",
                        BackgroundTransparency = 1,
                        Position = UDim2.fromOffset(15, 30),
                        Size = UDim2.new(1, -130, 0, 20),
                        Font = NeonUI.Theme.Font,
                        Text = button.Description,
                        TextColor3 = Color3.fromRGB(180, 180, 180),
                        TextSize = NeonUI.Theme.FontSize - 2,
                        TextXAlignment = Enum.TextXAlignment.Left,
                        Parent = button.Container
                    })
                else
                    button.TitleLabel = Utility:Create("TextLabel", {
                        Name = "Title",
                        BackgroundTransparency = 1,
                        Position = UDim2.fromOffset(15, 0),
                        Size = UDim2.new(1, -130, 1, 0),
                        Font = NeonUI.Theme.Font,
                        Text = button.Title,
                        TextColor3 = NeonUI.Theme.Text,
                        TextSize = NeonUI.Theme.FontSize,
                        TextXAlignment = Enum.TextXAlignment.Left,
                        Parent = button.Container
                    })
                    
                    -- Si es tema lava, añadir gradiente
                    if window.Theme == "Lava" then
                        Utility:Create("UIGradient", {
                            Color = ColorSequence.new({
                                ColorSequenceKeypoint.new(0, NeonUI.Theme.Text),
                                ColorSequenceKeypoint.new(1, NeonUI.Theme.Accent)
                            }),
                            Parent = button.TitleLabel
                        })
                    end
                end
                
                -- Efectos de hover para el botón
                button.ButtonElement.MouseEnter:Connect(function()
                    Utility:Tween(button.ButtonElement, {
                        BackgroundColor3 = NeonUI.Theme.Accent:Lerp(Color3.new(1,1,1), 0.2),
                        Size = UDim2.new(0, 104, 0, 32),
                        Position = UDim2.new(1, -112, 0, (buttonHeight - 32) / 2)
                    }, 0.2, Enum.EasingStyle.Quad)
                end)
                
                button.ButtonElement.MouseLeave:Connect(function()
                    Utility:Tween(button.ButtonElement, {
                        BackgroundColor3 = NeonUI.Theme.Accent,
                        Size = UDim2.new(0, 100, 0, 30),
                        Position = UDim2.new(1, -110, 0, (buttonHeight - 30) / 2)
                    }, 0.2, Enum.EasingStyle.Quad)
                end)
                
                -- Efecto al hacer clic
                button.ButtonElement.MouseButton1Click:Connect(function()
                    Utility:Ripple(button.ButtonElement)
                    
                    -- Animación de pulsación
                    Utility:Tween(button.ButtonElement, {Size = UDim2.new(0, 95, 0, 28)}, 0.1, Enum.EasingStyle.Quad)
                    task.wait(0.1)
                    Utility:Tween(button.ButtonElement, {Size = UDim2.new(0, 100, 0, 30)}, 0.1, Enum.EasingStyle.Quad)
                    
                    task.spawn(button.Callback)
                end)
                
                -- Añadir a la lista de elementos
                table.insert(section.Elements, button)
                
                return button
            end
            
            -- Toggle (Interruptor)
            function section:AddToggle(options)
                options = options or {}
                local toggle = {
                    Title = options.Title or "Toggle",
                    Description = options.Description,
                    Default = options.Default or false,
                    Flag = options.Flag,
                    Callback = options.Callback or function() end,
                    Value = options.Default or false
                }
                
                -- Registrar flag si existe
                if toggle.Flag then
                    window.Flags[toggle.Flag] = toggle.Value
                end
                
                -- Altura del toggle (dependiendo de si tiene descripción)
                local toggleHeight = toggle.Description and 60 or 40
                
                -- Contenedor del toggle
                toggle.Container = Utility:Create("Frame", {
                    Name = toggle.Title .. "Toggle",
                    BackgroundColor3 = NeonUI.Theme.Secondary,
                    BackgroundTransparency = NeonUI.Theme.Transparency,
                    BorderSizePixel = 0,
                    Size = UDim2.new(1, 0, 0, toggleHeight),
                    Parent = section.ElementsContainer
                })
                
                -- Bordes redondeados
                Utility:Create("UICorner", {
                    CornerRadius = UDim.new(0, 6),
                    Parent = toggle.Container
                })
                
                -- Si es tema lava, añadir efectos
                if window.Theme == "Lava" then
                    -- Gradiente
                    Utility:Create("UIGradient", {
                        Color = ColorSequence.new({
                            ColorSequenceKeypoint.new(0, NeonUI.Theme.Secondary:Lerp(NeonUI.Theme.Primary, 0.3)),
                            ColorSequenceKeypoint.new(0.5, NeonUI.Theme.Secondary),
                            ColorSequenceKeypoint.new(1, NeonUI.Theme.Secondary:Lerp(NeonUI.Theme.Primary, 0.3))
                        }),
                        Rotation = 90,
                        Parent = toggle.Container
                    })
                    
                    -- Borde sutil
                    Utility:Create("UIStroke", {
                        Color = NeonUI.Theme.Accent,
                        Thickness = 1,
                        Transparency = 0.8,
                        ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
                        Parent = toggle.Container
                    })
                end
                
                -- Título y descripción
                if toggle.Description then
                    toggle.TitleLabel = Utility:Create("TextLabel", {
                        Name = "Title",
                        BackgroundTransparency = 1,
                        Position = UDim2.fromOffset(15, 10),
                        Size = UDim2.new(1, -65, 0, 20),
                        Font = NeonUI.Theme.Font,
                        Text = toggle.Title,
                        TextColor3 = NeonUI.Theme.Text,
                        TextSize = NeonUI.Theme.FontSize,
                        TextXAlignment = Enum.TextXAlignment.Left,
                        Parent = toggle.Container
                    })
                    
                    -- Si es tema lava, añadir gradiente
                    if window.Theme == "Lava" then
                        Utility:Create("UIGradient", {
                            Color = ColorSequence.new({
                                ColorSequenceKeypoint.new(0, NeonUI.Theme.Text),
                                ColorSequenceKeypoint.new(1, NeonUI.Theme.Accent)
                            }),
                            Parent = toggle.TitleLabel
                        })
                    end
                    
                    toggle.DescriptionLabel = Utility:Create("TextLabel", {
                        Name = "Description",
                        BackgroundTransparency = 1,
                        Position = UDim2.fromOffset(15, 30),
                        Size = UDim2.new(1, -65, 0, 20),
                        Font = NeonUI.Theme.Font,
                        Text = toggle.Description,
                        TextColor3 = Color3.fromRGB(180, 180, 180),
                        TextSize = NeonUI.Theme.FontSize - 2,
                        TextXAlignment = Enum.TextXAlignment.Left,
                        Parent = toggle.Container
                    })
                else
                    toggle.TitleLabel = Utility:Create("TextLabel", {
                        Name = "Title",
                        BackgroundTransparency = 1,
                        Position = UDim2.fromOffset(15, 0),
                        Size = UDim2.new(1, -65, 1, 0),
                        Font = NeonUI.Theme.Font,
                        Text = toggle.Title,
                        TextColor3 = NeonUI.Theme.Text,
                        TextSize = NeonUI.Theme.FontSize,
                        TextXAlignment = Enum.TextXAlignment.Left,
                        Parent = toggle.Container
                    })
                    
                    -- Si es tema lava, añadir gradiente
                    if window.Theme == "Lava" then
                        Utility:Create("UIGradient", {
                            Color = ColorSequence.new({
                                ColorSequenceKeypoint.new(0, NeonUI.Theme.Text),
                                ColorSequenceKeypoint.new(1, NeonUI.Theme.Accent)
                            }),
                            Parent = toggle.TitleLabel
                        })
                    end
                end
                
                -- Toggle switch mejorado
                toggle.Switch = Utility:Create("Frame", {
                    Name = "Switch",
                    BackgroundColor3 = toggle.Value and NeonUI.Theme.Accent or Color3.fromRGB(90, 90, 90),
                    BorderSizePixel = 0,
                    Position = UDim2.new(1, -55, 0.5, 0),
                    AnchorPoint = Vector2.new(0, 0.5),
                    Size = UDim2.fromOffset(40, 20),
                    Parent = toggle.Container
                })
                
                -- Bordes redondeados para switch
                Utility:Create("UICorner", {
                    CornerRadius = UDim.new(1, 0),
                    Parent = toggle.Switch
                })
                
                -- Si es tema lava, añadir efectos al switch cuando está activado
                if window.Theme == "Lava" and toggle.Value then
                    -- Brillo al switch cuando está activado
                    Utility:CreateGlow(toggle.Switch, NeonUI.Theme.Glow, 1.3)
                end
                
                -- Círculo del switch
                toggle.Circle = Utility:Create("Frame", {
                    Name = "Circle",
                    BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                    BorderSizePixel = 0,
                    Position = UDim2.new(0, toggle.Value and 22 or 2, 0.5, 0),
                    AnchorPoint = Vector2.new(0, 0.5),
                    Size = UDim2.fromOffset(16, 16),
                    Parent = toggle.Switch
                })
                
                -- Bordes redondeados para círculo
                Utility:Create("UICorner", {
                    CornerRadius = UDim.new(1, 0),
                    Parent = toggle.Circle
                })
                
                -- Sombra para el círculo
                Utility:Create("ImageLabel", {
                    Name = "Shadow",
                    BackgroundTransparency = 1,
                    Image = "rbxassetid://6014257812",
                    ImageColor3 = Color3.fromRGB(0, 0, 0),
                    ImageTransparency = 0.5,
                    Position = UDim2.fromScale(0.5, 0.5),
                    AnchorPoint = Vector2.new(0.5, 0.5),
                    Size = UDim2.new(1, 8, 1, 8),
                    ZIndex = toggle.Circle.ZIndex - 1,
                    Parent = toggle.Circle
                })
                
                -- Botón para interactuar
                toggle.Button = Utility:Create("TextButton", {
                    Name = "ToggleButton",
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 1, 0),
                    Text = "",
                    Parent = toggle.Container
                })
                
                -- Función para cambiar el estado
                function toggle:Set(value)
                    toggle.Value = value
                    Utility:Tween(toggle.Switch, {BackgroundColor3 = toggle.Value and NeonUI.Theme.Accent or Color3.fromRGB(90, 90, 90)}, 0.2)
                    Utility:Tween(toggle.Circle, {Position = UDim2.new(0, toggle.Value and 22 or 2, 0.5, 0)}, 0.2)
                    
                    -- Si es tema lava, manejar el brillo
                    if window.Theme == "Lava" then
                        if toggle.Value then
                            -- Añadir brillo si no existe
                            if not toggle.Switch:FindFirstChild("Glow") then
                                Utility:CreateGlow(toggle.Switch, NeonUI.Theme.Glow, 1.3)
                            end
                        else
                            -- Remover brillo si existe
                            if toggle.Switch:FindFirstChild("Glow") then
                                toggle.Switch.Glow:Destroy()
                            end
                        end
                    end
                    
                    if toggle.Flag then
                        window.Flags[toggle.Flag] = toggle.Value
                    end
                    
                    toggle.Callback(toggle.Value)
                end
                
                -- Establecer valor inicial
                toggle:Set(toggle.Value)
                
                -- Evento de clic
                toggle.Button.MouseButton1Click:Connect(function()
                    -- Efecto ripple
                    Utility:Ripple(toggle.Container)
                    toggle:Set(not toggle.Value)
                end)
                
                -- Añadir a la lista de elementos
                table.insert(section.Elements, toggle)
                
                return toggle
            end
            
            -- Método para obtener elemento por flag
            function tab:GetElement(flag)
                for _, section in ipairs(tab.Sections) do
                    for _, element in ipairs(section.Elements) do
                        if element.Flag == flag then
                            return element
                        end
                    end
                end
                return nil
            end
            
            return tab
        end
        
        -- Seleccionar tab
        function window:SelectTab(tab)
            if window.CurrentTab == tab then return end
            
            -- Ocultar tab actual si existe
            if window.CurrentTab then
                window.CurrentTab.Container.Visible = false
                Utility:Tween(window.CurrentTab.Button, {BackgroundColor3 = NeonUI.Theme.Primary}, 0.3, Enum.EasingStyle.Quad)
                
                -- Si es tema lava, quitar efectos
                if window.Theme == "Lava" then
                    -- Eliminar glows si existen
                    if window.CurrentTab.Button:FindFirstChild("Glow") then
                        window.CurrentTab.Button.Glow:Destroy()
                    end
                    
                    -- Restaurar color del texto
                    if window.CurrentTab.TitleLabel then
                        window.CurrentTab.TitleLabel.TextColor3 = NeonUI.Theme.Text
                    end
                    
                    -- Restaurar color del icono
                    if window.CurrentTab.IconImage then
                        window.CurrentTab.IconImage.ImageColor3 = NeonUI.Theme.Text
                    end
                end
            end
            
            -- Mostrar nuevo tab
            window.CurrentTab = tab
            tab.Container.Visible = true
            Utility:Tween(tab.Button, {BackgroundColor3 = NeonUI.Theme.Accent}, 0.3, Enum.EasingStyle.Quad)
            
            -- Si es tema lava, añadir efectos
            if window.Theme == "Lava" then
                -- Cambiar color del texto
                if tab.TitleLabel then
                    tab.TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                end
                
                -- Cambiar color del icono
                if tab.IconImage then
                    tab.IconImage.ImageColor3 = Color3.fromRGB(255, 255, 255)
                end
                
                -- Añadir efecto de brillo
                Utility:CreateGlow(tab.Button, NeonUI.Theme.Glow, 1.2)
            end
        end
        
        -- Obtener elementos por flag
        function window:GetFlag(flag)
            return window.Flags[flag]
        end
        
        -- Guardar configuración
        function window:SaveConfig(name)
            if not name then
                name = "default"
            end
            
            return SaveSystem:SaveSettings(name, window.Flags)
        end
        
        -- Cargar configuración
        function window:LoadConfig(name)
            if not name then
                name = "default"
            end
            
            local config = SaveSystem:LoadSettings(name)
            if not config then return false end
            
            -- Aplicar configuración cargada
            for flag, value in pairs(config) do
                window.Flags[flag] = value
                
                -- Recorrer tabs para encontrar el elemento
                for _, tab in pairs(window.Tabs) do
                    local element = tab:GetElement(flag)
                    if element and element.Set then
                        element:Set(value)
                    end
                end
            end
            
            return true
        end
        
        -- Animar aparición de la ventana
        Utility:Tween(window.Frame, {Size = targetSize}, 0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
        
        table.insert(self.Windows, window)
        return window
    end
    
    return NeonUI
end

return NeonUI
